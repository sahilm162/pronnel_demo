<div class="cell" [class.is-editing]="editing" tabindex="0">
  <span cdkOverlayOrigin #origin="cdkOverlayOrigin" class="anchor-box"></span>

  <ng-container *ngIf="!editing; else editTpl">
    <div #content class="cell-text">
      <span *ngIf="isEmpty(value)" class="cell-empty">â€”</span>

      <ng-container *ngIf="!isEmpty(value)">
        <span *ngIf="type==='text' || type==='number'">{{ value }}</span>

        <a *ngIf="type==='url'" [href]="value" target="_blank" rel="noopener noreferrer" class="cell-link">
          {{ value }}
        </a>
        <a *ngIf="type==='email'" [href]="'mailto:'+value" class="cell-link">
          {{ value }}
        </a>

        <span *ngIf="type==='priority'" [class]="badgeClassForPriority(value)">{{ value }}</span>

        <span *ngIf="type==='bucket'">
          {{ value || row?.bucket_name || row?.bucket_id }}
        </span>
      </ng-container>
    </div>
  </ng-container>

  <ng-template #editTpl>
    <div #content class="cell-edit">
      <input
        *ngIf="keyPath==='title' || keyPath==='custom_fields.text_txt' || keyPath==='custom_fields.url' || keyPath==='custom_fields.email_eml'"
        class="editor editor-input"
        type="text"
        [value]="draft"
        (click)="$event.stopPropagation()"
        (input)="draft = $any($event.target).value"
        (keydown)="onKeyDown($event)"
        (blur)="commit()"
      />

      <input
        *ngIf="keyPath==='custom_fields.number_num'"
        class="editor editor-input"
        type="text"
        inputmode="decimal"
        autocomplete="off"
        [value]="draft"
        (click)="$event.stopPropagation()"
        (input)="draft = $any($event.target).value"
        (keydown)="onKeyDown($event)"
        (blur)="commit()"
      />

      <select
        *ngIf="keyPath==='priority' || keyPath==='priority_label'"
        class="editor editor-select"
        [value]="draft"
        (click)="$event.stopPropagation()"
        (change)="draft = $any($event.target).value; commit()"
        (keydown)="onKeyDown($event)"
        (blur)="commit()"
      >
        <option value="U">U</option>
        <option value="H">H</option>
        <option value="M">M</option>
        <option value="L">L</option>
      </select>
    </div>
  </ng-template>
</div>